# we use ROS indigo for now

# Ubuntu 14.04
ubuntu-trusty:
  image: ubuntu:trusty
  variables:
    CI_ROS_DISTRO: indigo
  before_script:
    - sudo apt-get update -qq
    - sudo apt-get install -qq -y wget
    - sudo sh -c 'echo "deb http://packages.ros.org/ros/ubuntu trusty main" > /etc/apt/sources.list.d/ros-latest.list'
    - wget http://packages.ros.org/ros.key -O - | sudo apt-key add -
    - sudo apt-get update -qq
    - sudo apt-get install -qq -y python-rosdep build-essential cmake
    - sudo rosdep init
    - rosdep update
  
  stage: build
  script:
    - rosdep install --from-paths . -i -y -r --rosdistro $CI_ROS_DISTRO
    - mkdir build
    - cd build
    - cmake ..
    - make -j8


# Ubuntu 16.04
ubuntu-xenial:
  image: ubuntu:xenial
  variables:
    CI_ROS_DISTRO: kinetic
  before_script:
    - apt-get update -qq
    - apt-get install -qq -y wget sudo
    - sh -c 'echo "deb http://packages.ros.org/ros/ubuntu xenial main" > /etc/apt/sources.list.d/ros-latest.list'
    - wget http://packages.ros.org/ros.key -O - | sudo apt-key add -
    - sudo apt-get update -qq
    - sudo apt-get install -qq -y python-rosdep build-essential cmake
    - sudo rosdep init
    - rosdep update

  stage: build
  script:
    - rosdep install --from-paths . -i -y -r --rosdistro $CI_ROS_DISTRO
    # hack because of Ubuntu bug https://bugs.launchpad.net/ubuntu/+source/ceres-solver/+bug/1595692
    - echo "https://launchpad.net/ubuntu/+source/ceres-solver/1.11.0~dfsg0-5/+build/10472806/+files/ceres-solver-doc_1.11.0~dfsg0-5_all.deb" >> ceres.txt
    - echo "https://launchpad.net/ubuntu/+source/ceres-solver/1.11.0~dfsg0-5/+build/10472806/+files/libceres-dev_1.11.0~dfsg0-5_amd64.deb" >> ceres.txt
    - echo "https://launchpad.net/ubuntu/+source/ceres-solver/1.11.0~dfsg0-5/+build/10472806/+files/libceres1_1.11.0~dfsg0-5_amd64.deb" >> ceres.txt
    - echo "https://launchpad.net/ubuntu/+source/ceres-solver/1.11.0~dfsg0-5/+build/10472806/+files/libceres1-dbgsym_1.11.0~dfsg0-5_amd64.deb" >> ceres.txt
    - wget -i ceres.txt
    - dpkg -y -i *.deb 
    - mkdir build
    - cd build
    - cmake ..
    - make -j8
